name: Upload and Generate Signed URL

on:
  push:
    branches:
      - main

permissions:
  id-token: write
  contents: read
  
jobs:
  upload-and-sign:
    runs-on: ubuntu-latest

    steps:
    # Step 1: Checkout the repository
    - name: Checkout code
      uses: actions/checkout@v3

    - name: Configure AWS credentials with OIDC
      uses: aws-actions/configure-aws-credentials@v4
      with:
        role-to-assume: arn:aws:iam::440744228769:role/github-assumerole-test
        aws-region: us-east-1


#    - name: Generate signed URL for S3 object
#      run: |
#        signed_url=$(aws s3 presign s3://testingwq1234/123/Untitled.rtf --expires-in 604800)
#        echo "SIGNED_URL=$signed_url" >> $GITHUB_ENV

    - name: Set test results variables
      if: ${{ always() }}
      run: |
        echo "REPORT_URL=$(aws s3 presign s3://testingwq1234/123/Untitled.rtf --expires-in 604800)" >> $GITHUB_ENV
     
    - name: Use the pre-signed URL
      run: |
        cat $GITHUB_ENV
